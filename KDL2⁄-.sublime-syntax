%YAML 1.2
---
name             : KDL2â„-
# file_extensions  : [kdl,kdl2]
scope            : text.kdl2
first_line_match : '/-[[:blank:]]*kdl-version[[:blank:]]+2[[:blank:]]*$'
hidden           : true
version          : 2
extends          : Packages/KDL/KDL1.sublime-syntax
# â„-Slashdashed rules only to reduce the mess of a single file and allow for an easier comparison
variables:
  x:	'x'	#

contexts:
  main:
    - meta_include_prototype: false
    - match : ''
      push  : #âœ—â°
      #- meta_scope        : dbgâœ—Â¹
      - include: nodes

  nodesâ„-: #âœ—â°
    - include: linesp
    - include: nodeâ„-
    - include: anyğŸ›‘ # todo disable? strict mode
    # - include: any-pop

#â€”â€”â€” 0 Groups
  node-elementsâ„-:        #âœ—Â²
    - match               : (?={{node_sp_beg}}) # mandatory whitespace
      push                : #âœ—Â³ push to require ws before each element
      #- meta_scope        : dbgâœ—Â³nodeâ _argâˆ¨propâˆ¨childâ„-
      - include           : nodeâ s
      - include           : node_elsâ„-
      - include           : child_block4â„-
    - match               : '{'
      scope               : invalid.illegal.position.kdl punctuation.section.mapping.begin.kdl comment.line.slash-dash.kdl
      push                : child_block3-bodyâ„-
    - include             : nodech_terminator3â¸®â„-
    - include             : SğŸ›‘Â¹pre_sâˆ¨câˆ¨t

  node_elsâ„-:             #âœ—Â³
    - match               : '({{c_slashdash}})'
      scope               : comment.line.slash-dash.kdl punctuation.definition.comment.begin.kdl
      pop                 : 1
      set                 : # no terminator, /-; illegal
      #- meta_scope        : dbgâœ—nodeâ â„âˆ’argâˆ¨propâˆ¨childâ„âˆ’
      - include           : linesp
      - include           : pop_preâ¤
      - include           : node_terminatorğŸ›‘3
      - include           : argâˆ¨propâ„-
      - include           : child_blockâ„-
      - include           : pop # todo not style /- empty via branches above â†‘
    - include             : argâˆ¨propâ„-
    - include             : child_blockâ„-
    - include             : ï½
    - include             : node_terminator4â„-

  str_idâ„-:               # âœ—â´ from arg-â¸™2, property-value
    - include             : keyword1strğŸ›‘preâ â¤
    - match               : '([+-]|[+-]?\.)([0-9])'
      captures            :
        1:                  invalid.illegal.position.kdl comment.line.slash-dash.kdl
        2:                  invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
    - match               : '{{bareID}}'
      push                : #âœ—âµ
      - meta_scope        : meta.string.kdl string.unquoted.kdl comment.line.slash-dash.kdl
      - match             : '{{charID}}'
        scope             : string.unquoted.kdl comment.line.slash-dash.kdl
      - include           : ï½›3
      - include           : ï½3
      - include           : pop_pre_node_end
      - include           : charğŸ†”Â¬â„-
      - include           : pop3
  str_idsâ„-:              # âœ—â´ from arg-â¸™2, property-value
    - include             : keyword1strğŸ›‘preâ â¤
    - match               : '([+-]|[+-]?\.)([0-9])'
      captures            :
        1:                  invalid.illegal.position.kdl comment.line.slash-dash.kdl
        2:                  invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
    - match               : '{{bareID}}'
      push                : #âœ—âµ
      - meta_scope        : meta.string.kdl string.unquoted.kdl comment.line.slash-dash.kdl
      - match             : '{{charID}}'
        scope             : string.unquoted.kdl comment.line.slash-dash.kdl
      - include           : ï½›3
      - include           : ï½3
      - include           : pop_pre_node_end
      - include           : pop_pre-nodeâ 
      - include           : charğŸ†”Â¬â„-
      - include           : pop

  node_châˆ¨argpropâ„-:     #âœ—Â³
    - match               : '(?={{c_slashdash}})'
      pop                 : 1
      branch_point        : â¸™3node_châˆ¨argpropâ„-
      branch              : #âœ—â´â¸™
        - argâˆ¨propâ„-â¸™3
        - node_children_sâ„-â¸™3

  stringâ„-:
    - include: string-quoted-double3â„-
    - include: string-quoted-doubleâ„-
    - include: string-quoted-double3-rawâ„-
    - include: string-quoted-double-rawâ„-
  stringsâ„-:
    - include: strings-quoted-double3â„-
    - include: strings-quoted-doubleâ„-
    - include: strings-quoted-double3-rawâ„-
    - include: strings-quoted-double-rawâ„-
  stringsâ„-_node-id:
    - include: strings-quoted-double3â„-_node-id
    - include: strings-quoted-doubleâ„-_node-id
    - include: strings-quoted-double3-rawâ„-_node-id
    - include: strings-quoted-double-rawâ„-_node-id
  # numberâ„-:
  #   - include: binÂ¦octÂ¦hexâ„-partial
  #   - include: hexadecimalâ„-
  #   - include: octalâ„-
  #   - include: binaryâ„-
  #   - include: intâˆ¨decâˆ¨floatâ„-
  keywordâ„-:
    - include: keyword-partialâ„-
    - include: booleanâ„-
    - include: nilâ„-
    - include: floatkwâ„-
  keywordğŸ›‘â„-:
    - include: booleanğŸ›‘â„-
    - include: nullğŸ›‘â„-
    - include: floatkwğŸ›‘â„-
  keyword-partialâ„-:
    - include: bool-partialâ„-
    - include: null-partialâ„-
    - include: floatkw-partialâ„-
  keyword-partial-extğŸ›‘â„-:
    - include: bool-partial-extğŸ›‘â„-
    - include: null-partial-extğŸ›‘â„-
    - include: floatkw-partial-extğŸ›‘â„-
  keyword1strğŸ›‘preâ â¤â„-:
    - include: keyword1strğŸ›‘preâ ï¼›â„-
    - include: keyword1strğŸ›‘preâ¤â„-
  keyword1nodeğŸ›‘preâ â¤â„-:
    - include: keyword1nodeğŸ›‘preâ ï¼›â„-
    - include: keyword1nodeğŸ›‘preâ¤â„-



#â€”â€”â€” 1 Node: \- type
  nodeâ„-:                 #âœ—â° =node, but name is â„-scoped even without /- since e.g., parent was already â„-
    - include             : node_baseâ„-
    # - include             : node_terminatorâ„-
  â„-node:                 #âœ—â° â‰ (/- node-space*)? type? identifier
    - match               : '{{c_slashdash}}'
      scope               : comment.line.slash-dash.kdl punctuation.definition.comment.begin.kdl
      pop                 : 1 # pops into main, so need to repeat main's ctx: nodes
      push                : # pop+push: match gets NO meta_scope of the popped context (â‰ˆlookahead)
      - meta_scope        : comment.block.slash-dash.kdl #âœ—â° # comment.line.slash-dash added last @content
      - include           : nodeâ 
      - include           : nodetIDâ„-
      - include           : nodes
  node_baseâ„-:            #âœ—â°
    - include             : â„-node
    - include             : nodetIDâ„-
  nodetIDâ„-:              #âœ—â°
    - include             : linespâ„-
    - match               : '(?=\()'
      push                :
      - meta_scope        : meta.node.kdl #âœ—Â¹node_baseâ„â€“_t
      - include           : type-nodeâ„-
    - match               : '(?={{string_beg}}|{{bareID}})'
      push                :
      - meta_scope        : meta.node.kdl #âœ—Â¹node_baseâ„â€“_s_b
      - include           : nodeIDâ„-

  type-nodeâ„-:            #âœ—Â¹
    - match               : \(
      scope               : punctuation.separator.annotation.begin.kdl comment.line.slash-dash.kdl #âœ—typenodeâ„â€“open
      push                : #âœ—Â²
      - meta_scope        : meta.annotation.kdl #âœ—Â²m
      - meta_content_scope: entity.name.type.kdl #âœ—Â²c
      - match             : '(?<=\()({{u_sp}}*\))|(\))'
        captures          :
          1:                invalid.illegal.muted.kdl #punctuation.separator.annotation.end.kdl invalid.illegal.position.kdl
          2:                punctuation.separator.annotation.end.kdl comment.line.slash-dash.kdl #âœ—typenodeâ„â€“close
        pop               : 2 # remove 1st annotation, 2 fixes a bug?
        set               : #âœ—Â¹
        - include         : nodeâ 
        - include         : nodeIDâ„-
        - include         : charğŸ†”Â¬
        - include         : anyğŸ›‘s
      - include           : nodeâ 
      - include           : type-content-nodeâ„-
      - include           : typeğŸ›‘

  type-content-nodeâ„-:
    - include             : keywordğŸ›‘â„-
    - match               : '(?={{string_beg}})' # string can't just use to ban "a""b"
      push                : #âœ—Â³
      # - meta_scope        : dbgtype-content-nodeâœ—Â³
      - include           : strings-quoted-double-raw-consecutiveğŸ›‘
      - include           : strings-quoted-double-consecutiveğŸ›‘
      - include           : stringsâ„-
      - include           : pop_preï¼‰ # remove â†‘
      - include           : anyğŸ›‘s
    - include             : ID_bare_sğŸ›‘



#â€”â€”â€” 2 Node Element: 1 Name
  nodeIDâ„-:               #âœ—Â¹
    # - include             : keywordsâ„-ğŸ›‘
    - include             : keyword1nodeğŸ›‘preâ â¤â„-
    - match               : '(?={{string_beg}})'
      push                : #âœ—Â²
      # - meta_scope        : entity.name.tag.node.kdl #âœ—Â²
      - include           : string-quoted-double-raw-consecutiveğŸ›‘3
      - include           : string-quoted-double-consecutiveğŸ›‘3
      - include           : stringsâ„-_node-id # use custom strings scopes or meta_scope gets applied to "args"
      - include           : node-elementsâ„-
      # - include           : node_terminator3â„-
    - include             : bare-after-stringğŸ›‘
    - match               : '([+-]|[+-]?\.)([0-9])'
      scope               : entity.name.tag.node.kdl comment.line.slash-dash.kdl
      captures            :
        1:                  invalid.illegal.position.kdl comment.line.slash-dash.kdl
        2:                  invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
    - match               : '{{bareID}}'
      scope               : entity.name.tag.node.kdl comment.line.slash-dash.kdl
      push                : #âœ—Â²
      #- meta_scope        : dbgâœ—Â²_nodeIDâ†’node-elementsâ„â€“
      - include           : node-elementsâ„-
      # - include           : node_terminator3â„-
      - include           : SğŸ›‘s

#â€”â€”â€” 2 Node Element: 2 Argument or 3 Property
  # argâˆ¨propâ„-:             #âœ—Â³
  #   # - include           : nodeâ â„-
  #   - include             : arg_typedâ„-
  #   - include             : arg_untypedâˆ¨propâ„-
  argâˆ¨propâ„-unâ„-:          #âœ—Â³
    # - include           : nodeâ â„-
    - include             : arg_typedâ„-
    - include             : arg_untypedâˆ¨propâ„-unâ„-

  arg_untypedâˆ¨propâ„-:     #âœ—Â³
    - match               : '(?={{string_beg}})'
      branch_point        : â¸™1â€œargâˆ¨propâ€â„-
      branch              : #âœ—â´â¸™
        - â€œargâ€â„-â¸™1
        - â€œâš¿â€â‚Œvâ„-â¸™1
    - match               : '(?={{charID_or_KW}})'
      branch_point        : â¸™2argâˆ¨propâ„-
      branch              : #âœ—â´â¸™
        - argâ„-â¸™2
        - âš¿â‚Œvâ„-â¸™2
  arg_untypedâˆ¨propâ„-unâ„-: #âœ—Â³
    - match               : '(?={{string_beg}})'
      branch_point        : â¸™1â€œargâˆ¨propâ€â„-unâ„-
      branch              : #âœ—â´â¸™
        - â€œargâ€â„-â¸™1unâ„-
        - â€œâš¿â€â‚Œvâ„-â¸™1
    - match               : '(?={{charID_or_KW}})'
      branch_point        : â¸™2argâˆ¨propâ„-unâ„-
      branch              : #âœ—â´â¸™
        - argâ„-â¸™2unâ„-
        - âš¿â‚Œvâ„-â¸™2

  argâˆ¨propâ„-â¸™3:          #âœ—â´â¸™
    - meta_scope          : meta.argument.value.kdl meta.mapping.value.kdl #âœ—â´argâˆ¨propâ„-â¸™3
    - match               : '({{c_slashdash}})'
      scope               : comment.line.slash-dash.kdl punctuation.definition.comment.begin.kdl #invalid.illegal
      pop                 : 1
      set                 :
      #- meta_scope        : dbgâœ—Â³nodeâ â„âˆ’argâˆ¨prop (not child)
      - include           : linesp
      - include           : node_terminatorğŸ›‘3
      - include           : argâˆ¨propâ„-unâ„-
      - match             : '{'
        fail              : â¸™3node_châˆ¨argpropâ„-
      - include           : popâ¸™ # todo not style /- empty via branches above â†‘
    - match               : ''
      fail                : â¸™3node_châˆ¨argpropâ„-
      # - include           : SğŸ›‘Â¹pre_sâˆ¨câˆ¨t

#â€”â€”â€” 2 Node Element: 2 Argument
  # â€œargâ€â„-â¸™1:               #âœ—â´
  #   - meta_scope          : meta.argument.value.kdl meta.mapping.value.kdl #âœ—â´â€œargâ€â„â¸™1
  #   - include             : â€œargâ€â„-
  #   - include             : â€œargâ€ğŸ›‘
  #   - include             : popâ¸™
  â€œargâ€â„-â¸™1unâ„-:          #âœ—â´
    - meta_scope          : meta.argument.value.kdl meta.mapping.value.kdl #âœ—â´â€œargâ€â„â¸™1
    - include             : â€œargâ€â„-unâ„-
    - include             : â€œargâ€ğŸ›‘
    - include             : popâ¸™
  argâ„-â¸™2:                #âœ—â´ continues with    â„- styled elements
    - meta_scope          : meta.argument.value.kdl meta.mapping.value.kdl #âœ—â´argâ„_â¸™2
    - match               : (?={{node_sp_beg}})
      pop                 : 1
      push                : #âœ—â´
      - include           : nodeâ 
      - match             : '{{prop_eq}}'
        fail              : â¸™2argâˆ¨propâ„-
      - match             : ''
        pop               : 2 #âœ—Â²
        push              : node_elsâ„- #âœ—Â³
    - match               : '(\S*)(?==)'
      fail                : â¸™2argâˆ¨propâ„-
    - include             : valueâ„-
    - include             : str_idsâ„-
    - include             : valueğŸ›‘â„-
    - include             : pop_preâ¤
    - include             : popâ¸™
  argâ„-â¸™2unâ„-:            #âœ—â´ continues with nonâ„- styled elements
    - meta_scope          : meta.argument.value.kdl meta.mapping.value.kdl #âœ—â´argâ„_â¸™2
    - match               : (?={{node_sp_beg}})
      pop                 : 1
      push                : #âœ—â´
      - include           : nodeâ 
      - match             : '{{prop_eq}}'
        fail              : â¸™2argâˆ¨propâ„-unâ„-
      - match             : ''
        pop               : 2 #âœ—Â²
        push              : node_els   #âœ—Â³
    - match               : '(\S*)(?==)'
      fail                : â¸™2argâˆ¨propâ„-unâ„-
    - include             : valueâ„-
    - include             : str_idsâ„-
    - include             : valueğŸ›‘â„-
    - include             : pop_preâ¤
    - include             : popâ¸™

  # arg_typedâ„-:            #âœ—Â³
  #   - match               : (?=\()
  #     set                 :
  #     - meta_scope        : meta.argument.value.kdl meta.mapping.value.kdl #âœ—Â³typedâ„-
  #     - include           : type-valueâ„-
  â€œargâ€â„-:                #âœ—â´ continues with    â„- styled elements
    - match               : (?={{node_sp_beg}}) # limit nodeâ  to pre= only otherwise 'a p=1' fails due to '(\S*)(?==)'
      pop                 : 1
      push                : #âœ—â´
      - include           : nodeâ 
      - match             : '{{prop_eq}}'
        fail              : â¸™1â€œargâˆ¨propâ€â„-
      - match             : ''
        pop               : 2 #âœ—Â²
        push              : node_elsâ„- #âœ—Â³
    - match               : '(?={{string_beg}})'
      push                : #âœ—âµ
      # - meta_scope        : dbgâ€œargâ€âœ—âµ
      - include           : string-quoted-double-raw-consecutiveğŸ›‘3
      - include           : string-quoted-double-consecutiveğŸ›‘3
      - include           : stringsâ„-
      - match             : '{{prop_eq}}'
        fail              : â¸™1â€œargâˆ¨propâ€â„-
      - include           : pop # 1 to allow searching and failing on =
      # - include           : pop3  # Â¹arg_untypedâˆ¨prop branch Â²â†‘ 3 exit
  â€œargâ€â„-unâ„-:            #âœ—â´ continues with  nonâ„- styled elements
    - match               : (?={{node_sp_beg}})
      pop                 : 1
      push                : #âœ—â´
      - include           : nodeâ 
      - match             : '{{prop_eq}}'
        fail              : â¸™1â€œargâˆ¨propâ€â„-unâ„-
      - match             : ''
        pop               : 2 #âœ—Â²
        push              : node_els   #âœ—Â³
    - match               : '(?={{string_beg}})'
      push                : #âœ—âµ
      - include           : string-quoted-double-raw-consecutiveğŸ›‘3
      - include           : string-quoted-double-consecutiveğŸ›‘3
      - include           : stringsâ„-
      - match             : '{{prop_eq}}'
        fail              : â¸™1â€œargâˆ¨propâ€â„-unâ„-
      - include           : pop # 1 to allow searching and failing on =
      # - include           : pop3  # Â¹arg_untypedâˆ¨prop branch Â²â†‘ 3 exit

  ## argâ„-:                  #âœ—â´
  ##   - include             : type-valueâ„-
  ##   - include             : valueâ„-
  ##   - include             : valueğŸ›‘

  # valueâ„-:                #âœ—â´
  #   - include             : keywordâ„-
  #   - include             : stringâ„-
  #   - include             : numberâ„-
  valueğŸ›‘â„-:
    - include             : ï¼ƒmaybe-keywordğŸ›‘â„-
    - include             : valğŸ›‘
    - include             : chğŸ›‘pre_term
    - include             : chğŸ›‘pre-str

#â€”â€”â€” 2 Node Element: 3 Property
  âš¿â‚Œvâ„-â¸™2:                #âœ—â´
    - meta_scope          : meta.property.kdl #âœ—â´âš¿â‚Œvâ„â€“â¸™
    - include             : ï¼ƒnon-keywordğŸ›‘
    - include             : keywordğŸ›‘â„-
    - include             : ID_bareÂ¬1stğŸ›‘â„-
    - include             : âš¿â„-
  âš¿â„-:                    #âœ—â´
    - match               : '({{charID}}+)'
      scope               : entity.other.attribute-name.kdl comment.line.slash-dash.kdl
      pop                 : 1 # â†‘â¸™
      push                :
        - meta_scope      : meta.property.name.kdl meta.mapping.key.kdl #âœ—â´
        - include         : nodeâ 
        - include         : propertyâ‚Œâ„-
        - include         : pop_pre-term

  # â€œâš¿â€â‚Œvâ„-â¸™1:
  #   - meta_scope          : meta.property.name.kdl meta.mapping.key.kdl entity.other.attribute-name.kdl comment.line.slash-dash.kdl
  #   - include             : â€œâš¿â€â„-
  â€œâš¿â€â„-:
    - include             : stringsâ„-
    - include             : nodeâ 
    - include             : propertyâ‚Œâ„-
  propertyâ‚Œâ„-:            #âœ—â´
    - match               : '(=)'
      scope               : meta.property.separator.kdl meta.mapping.separator.kdl punctuation.separator.key-value.kdl comment.line.slash-dash.kdl
      pop                 : 1
      push                : property-valueâ„- # todo: set bugs to clear
  property-valueâ„-:       # âœ—â´

    - meta_content_scope  : meta.property.value.kdl meta.mapping.value.kdl #âœ—â´
    - include             : comments #commentsâ„-
    - include             : nodeâ â„-
    - match               : (?=\()
      pop                 : 2 # âš¿â‚Œvâ„-â¸™2 to reach Â³ like arg_typedâ„-
      push                : #âœ—Â³
      - meta_scope        : meta.property.value.kdl meta.mapping.value.kdl #âœ—Â³propâ„â€“_typ_val
      - include           : type-valueâ„-
    - match               : (?!\() # required to apply proper context to value
      set                 : #âœ—â´
      - meta_scope        : meta.property.value.kdl meta.mapping.value.kdl #âœ—â´propâ„â€“_val_untyp

      - include           : valueâ„-
      - include           : str_idâ„-
      - include           : valueğŸ›‘
    - include             : propertyğŸ›‘

#â€”â€”â€” Type-values
  type-valueâ„-:           #âœ—Â³
    - match               : \(
      scope               : punctuation.separator.annotation.begin.kdl comment.line.slash-dash.kdl #âœ—typeargâ„-
      push                : #âœ—â´
      - meta_scope        : meta.annotation.kdl #âœ—â´type-valueâ„â€“
      - meta_content_scope: entity.name.type.kdl comment.line.slash-dash.kdl
      - match             : '(?<=\()({{u_sp}}*\))|(\))'
        captures          :
          1:                invalid.illegal.muted.kdl #punctuation.separator.annotation.end.kdl invalid.illegal.position.kdl
          2:                punctuation.separator.annotation.end.kdl comment.line.slash-dash.kdl
        pop               : 1 # remove â†‘annotation
        set               : # push bugs even with pop, still get meta_content
        - include         : nodeâ 
        - include         : valueâ„-
        - include         : str_idâ„-
        - include         : valueğŸ›‘
        - include         : anyğŸ›‘s
      - include           : nodeâ 
      - include           : type-name
      - include           : typeğŸ›‘

  type-nameâ„-:
    - include             : keywordğŸ›‘â„-
    - match               : '(?={{string_beg}})'
      push                : #âœ—âµ
      # - meta_scope        : dbgtype-nameâ„â€“âœ—âµ
      - include           : strings-quoted-double-raw-consecutiveğŸ›‘
      - include           : strings-quoted-double-consecutiveğŸ›‘
      - include           : stringsâ„-
      - include           : pop_preï¼‰ # remove â†‘
      - include           : anyğŸ›‘s
    - include             : ID_bare_sğŸ›‘
  # # type-contentâ„-:
  # #   - include             : keywordğŸ›‘â„-
  # #   - include             : stringâ„-
  # #   - include             : IDs_bare



#â€”â€”â€” Values - Keywords
  booleanâ„-:
    - match               : \#\b(true|false)\b
      scope               : keyword.other.kdl constant.language.boolean.kdl comment.line.slash-dash.kdl
      pop                 : 2
  nilâ„-:
    - match               : '\#\b(null)\b'
      scope               : keyword.other.kdl constant.language.null.kdl comment.line.slash-dash.kdl
      pop                 : 2
  floatkwâ„-:
    - match               : \#-?\b(inf)\b
      scope               : keyword.other.kdl constant.language.float.kdl comment.line.slash-dash.kdl
      pop                 : 2
    - match               : \#\b(nan)\b
      scope               : keyword.other.kdl constant.language.float.kdl comment.line.slash-dash.kdl
      pop                 : 2

  # before     sp begin
  # after  = ) sp end (though can't detect line continuation, add that condition within line cont rule)
  bool-partialâ„-:
    - match               : '(?<={{pre_val}})\#(tr?u?|fa?l?s?)(?={{any_sp_t_beg}})'
      scope               : comment.line.slash-dash.kdl
      pop                 : 2
  null-partialâ„-:
    - match               : '(?<={{pre_val}})\#(nu?l?)(?={{any_sp_t_beg}})'
      scope               : comment.line.slash-dash.kdl
      pop                 : 2
  floatkw-partialâ„-:
    - match               : '(?<={{pre_val}})\#(-?in?)(?={{any_sp_t_beg}})'
      scope               : comment.line.slash-dash.kdl
      pop                 : 2
    - match               : '(?<={{pre_val}})\#(n?a)(?={{any_sp_t_beg}})'
      scope               : comment.line.slash-dash.kdl
      pop                 : 2

  bool-partial-extğŸ›‘â„-:
    - match               : '(?<={{pre_val}})(\#)(tr?u?e?|fa?l?s?e?)({{charID_or_KW}}+)'
      captures            :
        1:                                               comment.line.slash-dash.kdl
        2:                                               comment.line.slash-dash.kdl
        3:                  invalid.illegal.position.kdl comment.line.slash-dash.kdl
      pop                 : 2
  null-partial-extğŸ›‘â„-:
    - match               : '(?<={{pre_val}})(\#)(nul?l?)({{charID_or_KW}}+)'
      captures            :
        1:                                               comment.line.slash-dash.kdl
        2:                                               comment.line.slash-dash.kdl
        3:                  invalid.illegal.position.kdl comment.line.slash-dash.kdl
      pop                 : 2
  floatkw-partial-extğŸ›‘â„-:
    - match               : '(?<={{pre_val}})(\#)(-?in?f?)({{charID_or_KW}}+)'
      captures            :
        1:                                               comment.line.slash-dash.kdl
        2:                                               comment.line.slash-dash.kdl
        3:                  invalid.illegal.position.kdl comment.line.slash-dash.kdl
      pop                 : 2
    - match               : '(?<={{pre_val}})(\#)(na?n?)({{charID_or_KW}}+)'
      captures            :
        1:                                               comment.line.slash-dash.kdl
        2:                                               comment.line.slash-dash.kdl
        3:                  invalid.illegal.position.kdl comment.line.slash-dash.kdl
      pop                 : 2

  ï¼ƒmaybe-keywordğŸ›‘â„-:
    - match               : '(?=\#)'
      push                : #âœ—âµ
      # - meta_scope        : ï¼ƒmaybe-keywordğŸ›‘â„-âœ—âµ
      - include           : keyword-partial-extğŸ›‘â„-
      - match             : '(\#)?({{charID_or_KW}})({{charID_or_KW}}*)'
        scope             : keyword.other.kdl
        captures          :
          1:                                                  comment.line.slash-dash.kdl
          2:               invalid.illegal.position.kdl comment.line.slash-dash.kdl
          3:               invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
        pop                 : 2

  booleanğŸ›‘â„-:
    - match               : '(\#)?((t)(rue)|(f)(alse))(?=[^{{charID}}])'
      scope               : keyword.other.kdl constant.language.boolean.kdl
      captures            :
        1:                 invalid.illegal.position.kdl comment.line.slash-dash.kdl
        3:                 invalid.illegal.position.kdl comment.line.slash-dash.kdl
        4:                 invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
        5:                 invalid.illegal.position.kdl comment.line.slash-dash.kdl
        6:                 invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
  nullğŸ›‘â„-:
    - match               : '(\#)?((n)(ull))(?=[^{{charID}}])'
      scope               : keyword.other.kdl constant.language.null.kdl
      captures            :
        1:                 invalid.illegal.position.kdl comment.line.slash-dash.kdl
        3:                 invalid.illegal.position.kdl comment.line.slash-dash.kdl
        4:                 invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
  floatkwğŸ›‘â„-:
    - match               : '(\#)?((-)?(i)(nf))(?=[^{{charID}}])'
      scope               : keyword.other.kdl constant.language.float.kdl
      captures            :
        1:                 invalid.illegal.position.kdl comment.line.slash-dash.kdl
        3:                 invalid.illegal.position.kdl comment.line.slash-dash.kdl
        4:                 invalid.illegal.position.kdl comment.line.slash-dash.kdl
        5:                 invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
    - match               : '(\#)?((n)(an))(?=[^{{charID}}])'
      scope               : keyword.other.kdl constant.language.float.kdl
      captures            :
        1:                 invalid.illegal.position.kdl comment.line.slash-dash.kdl
        3:                 invalid.illegal.position.kdl comment.line.slash-dash.kdl
        4:                 invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl

  keyword1strğŸ›‘preâ ï¼›â„-:    # to avoid red flashes, mark last char as illegal before â  or ; (rest muted)
    - match               : '((tru)(e)|(fals)(e)|(nul)(l)|(-?in)(f)|(na)(n))(?={{u_sp}}|;)'
      captures            :
        # 1:                  invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
        2:                  invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
        3:                  invalid.illegal.position.kdl comment.line.slash-dash.kdl
        4:                  invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
        5:                  invalid.illegal.position.kdl comment.line.slash-dash.kdl
        6:                  invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
        7:                  invalid.illegal.position.kdl comment.line.slash-dash.kdl
        8:                  invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
        9:                  invalid.illegal.position.kdl comment.line.slash-dash.kdl
        10:                 invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
        11:                 invalid.illegal.position.kdl comment.line.slash-dash.kdl
  keyword1nodeğŸ›‘preâ ï¼›â„-:   # to avoid red flashes, mark last char as muted before â  or ; (rest node)
    - match               : '((tru)(e)|(fals)(e)|(nul)(l)|(-?in)(f)|(na)(n))(?={{u_sp}}|;|})'
      captures            :
        # 1:                  entity.name.tag.node.kdl comment.line.slash-dash.kdl
        2:                  entity.name.tag.node.kdl comment.line.slash-dash.kdl
        3:                  invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
        4:                  entity.name.tag.node.kdl comment.line.slash-dash.kdl
        5:                  invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
        6:                  entity.name.tag.node.kdl comment.line.slash-dash.kdl
        7:                  invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
        8:                  entity.name.tag.node.kdl comment.line.slash-dash.kdl
        9:                  invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
        10:                 entity.name.tag.node.kdl comment.line.slash-dash.kdl
        11:                 invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
      push                : #âœ—Â²
      - include           : node-elementsâ„-
      - include           : SğŸ›‘s
  keyword1strğŸ›‘preâ¤â„-:      # to avoid red flashes, mark last char as illegal before â¤ or ; (rest string)
    - match               : '((tru)(e)|(fals)(e)|(nul)(l)|(-?in)(f)|(na)(n))(?={{newline}})'
      captures            :
        2:                  meta.string.kdl string.unquoted.kdl comment.line.slash-dash.kdl
        3:                  invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
        4:                  meta.string.kdl string.unquoted.kdl comment.line.slash-dash.kdl
        5:                  invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
        6:                  meta.string.kdl string.unquoted.kdl comment.line.slash-dash.kdl
        7:                  invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
        8:                  meta.string.kdl string.unquoted.kdl comment.line.slash-dash.kdl
        9:                  invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
        10:                 meta.string.kdl string.unquoted.kdl comment.line.slash-dash.kdl
        11:                 invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
  keyword1nodeğŸ›‘preâ¤â„-:     # to avoid red flashes, mark last char as illegal before â¤ or ; (rest node)
    - match               : '((tru)(e)|(fals)(e)|(nul)(l)|(-?in)(f)|(na)(n))(?={{newline}})'
      captures            :
        2:                  entity.name.tag.node.kdl comment.line.slash-dash.kdl
        3:                  invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
        4:                  entity.name.tag.node.kdl comment.line.slash-dash.kdl
        5:                  invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
        6:                  entity.name.tag.node.kdl comment.line.slash-dash.kdl
        7:                  invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
        8:                  entity.name.tag.node.kdl comment.line.slash-dash.kdl
        9:                  invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
        10:                 entity.name.tag.node.kdl comment.line.slash-dash.kdl
        11:                 invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
      push                : #âœ—Â²
      - include           : node-elementsâ„-
      - include           : SğŸ›‘s


#â€”â€”â€” Values - Strings
  string-quoted-doubleâ„-:
    - match               : '(r?)(")'
      captures            :
        1:                  invalid.illegal.position.kdl comment.line.slash-dash.kdl
        2:                  punctuation.definition.string.begin.kdl comment.line.slash-dash.kdl
      push                :
      - meta_scope        : meta.string.kdl string.quoted.double.kdl
      - meta_content_scope: comment.line.slash-dash.kdl
      - match             : '"'
        scope             : punctuation.definition.string.end.kdl comment.line.slash-dash.kdl
        pop               : 3
      - include           : char-escapedâ„-
      - include           : â¤ğŸ›‘Â¹s
  string-quoted-double3â„-:
    - match               : '(r?)(""")({{nl_not_s}}?)({{nl_not_s}}*)'
      captures            :
        1:                 invalid.illegal.position.kdl comment.line.slash-dash.kdl
        2:                 punctuation.definition.string.begin.kdl comment.line.slash-dash.kdl
        3:                 invalid.illegal.position.kdl comment.line.slash-dash.kdl
        4:                 invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
      push                :
      - meta_scope        : meta.string.kdl string.quoted.double.block.kdl
      - meta_content_scope: comment.line.slash-dash.kdl
      - match             : '^(({{u_sp}}|((\\)({{u_sp}}|{{newline}})+))*)({{u_sp_not}}?)([\s\S]*?)(""")'
      # - match             : '^((\s|\\\s+)*)([^\"]?)([^\"]*)(""")'
        captures          : # will only highlight the last \, don't know how to fix
          1:               whitespace.dedent.kdl comment.line.slash-dash.kdl
          3:               constant.character.escape.kdl comment.line.slash-dash.kdl
          4:               punctuation.definition.escape.begin.kdl comment.line.slash-dash.kdl
          6:               invalid.illegal.position.kdl comment.line.slash-dash.kdl
          7:               invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
          8:               punctuation.definition.string.end.kdl comment.line.slash-dash.kdl
        pop               : 3
      - include           : char-esc-multiâ„-2
  strings-quoted-doubleâ„-:
    - match               : '(r?)(")'
      captures            :
        1:                  invalid.illegal.position.kdl comment.line.slash-dash.kdl
        2:                  punctuation.definition.string.begin.kdl comment.line.slash-dash.kdl
      push                :
      - meta_scope        : meta.string.kdl string.quoted.double.kdl
      - meta_content_scope: comment.line.slash-dash.kdl
      - match             : '"'
        scope             : punctuation.definition.string.end.kdl comment.line.slash-dash.kdl
        pop               : 1
      - include           : char-escapedâ„-
      - include           : â¤ğŸ›‘Â¹s
  strings-quoted-double3â„-:
    - match               : '(r?)(""")({{nl_not_s}}?)({{nl_not_s}}*)'
      captures            :
        1:                 invalid.illegal.position.kdl comment.line.slash-dash.kdl
        2:                 punctuation.definition.string.begin.kdl comment.line.slash-dash.kdl
        3:                 invalid.illegal.position.kdl comment.line.slash-dash.kdl
        4:                 invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
      push                :
      - meta_scope        : meta.string.kdl string.quoted.double.block.kdl
      - meta_content_scope: comment.line.slash-dash.kdl
      - match             : '^(({{u_sp}}|((\\)({{u_sp}}|{{newline}})+))*)({{u_sp_not}}?)([\s\S]*?)(""")'
      # - match             : '^((\s|\\\s+)*)([^\"]?)([^\"]*)(""")'
        captures          : # will only highlight the last \, don't know how to fix
          1:               whitespace.dedent.kdl comment.line.slash-dash.kdl
          3:               constant.character.escape.kdl comment.line.slash-dash.kdl
          4:               punctuation.definition.escape.begin.kdl comment.line.slash-dash.kdl
          6:               invalid.illegal.position.kdl comment.line.slash-dash.kdl
          7:               invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
          8:               punctuation.definition.string.end.kdl comment.line.slash-dash.kdl
        pop               : 1
      - include           : char-esc-multiâ„-
  strings-quoted-doubleâ„-_node-id:
    - match               : '(r?)(")'
      captures            :
        1:                  invalid.illegal.position.kdl comment.line.slash-dash.kdl
        2:                  punctuation.definition.string.begin.kdl comment.line.slash-dash.kdl
      push                :
      - meta_scope        : entity.name.tag.node.kdl meta.string.kdl string.quoted.double.kdl
      - meta_content_scope: comment.line.slash-dash.kdl
      - match             : '"'
        scope             : punctuation.definition.string.end.kdl comment.line.slash-dash.kdl
        pop               : 1
      - include           : char-escapedâ„-
      - include           : â¤ğŸ›‘Â¹s
  strings-quoted-double3â„-_node-id:
    - match               : '(r?)(""")({{nl_not_s}}?)({{nl_not_s}}*)'
      captures            :
        1:                 invalid.illegal.position.kdl comment.line.slash-dash.kdl
        2:                 punctuation.definition.string.begin.kdl comment.line.slash-dash.kdl
        3:                 invalid.illegal.position.kdl comment.line.slash-dash.kdl
        4:                 invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
      push                :
      - meta_scope        : entity.name.tag.node.kdl meta.string.kdl string.quoted.double.block.kdl
      - meta_content_scope: comment.line.slash-dash.kdl
      - match             : '^(({{u_sp}}|((\\)({{u_sp}}|{{newline}})+))*)({{u_sp_not}}?)([\s\S]*?)(""")'
      # - match             : '^((\s|\\\s+)*)([^\"]?)([^\"]*)(""")'
        captures          : # will only highlight the last \, don't know how to fix
          1:               whitespace.dedent.kdl comment.line.slash-dash.kdl
          3:               constant.character.escape.kdl comment.line.slash-dash.kdl
          4:               punctuation.definition.escape.begin.kdl comment.line.slash-dash.kdl
          6:               invalid.illegal.position.kdl comment.line.slash-dash.kdl
          7:               invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
          8:               punctuation.definition.string.end.kdl comment.line.slash-dash.kdl
        pop               : 1
      - include           : char-esc-multiâ„-
  char-escapedâ„-:
    - match               : '(\\)'
      scope               : constant.character.escape.kdl punctuation.definition.escape.begin.kdl comment.line.slash-dash.kdl
      push                :
      - match             : '({{esc_char_s}})'
        captures          :
          1:               constant.character.escape.kdl comment.line.slash-dash.kdl
        pop               : 1
      - include           : char-esc-uniâ„-ğŸ›‘
      - include           : char-esc-uniâ„-
      - include           : uâ â¤s
      - include           : anyğŸ›‘
  char-esc-multiâ„-: # same as char-escapedâ„-, but error-pops on ending """ as it "eats" the â¤ that this ending requires
    - match               : '(\\)'
      scope               : constant.character.escape.kdl punctuation.definition.escape.begin.kdl comment.line.slash-dash.kdl
      push                :
      - match             : '({{esc_char_s}})'
        captures          :
          1:               constant.character.escape.kdl comment.line.slash-dash.kdl
        pop               : 1
      - include           : char-esc-uniâ„-ğŸ›‘
      - include           : char-esc-uniâ„-
      - include           : uâ â¤sğŸ›‘â€â€â€â„-2
      - include           : anyğŸ›‘
  char-esc-multiâ„-2: # same as char-escapedâ„-, but error-pops on ending """ as it "eats" the â¤ that this ending requires
    - match               : '(\\)'
      scope               : constant.character.escape.kdl punctuation.definition.escape.begin.kdl comment.line.slash-dash.kdl
      push                :
      - match             : '({{esc_char_s}})'
        captures          :
          1:               constant.character.escape.kdl comment.line.slash-dash.kdl
        pop               : 1
      - include           : char-esc-uniâ„-ğŸ›‘
      - include           : char-esc-uniâ„-
      - include           : uâ â¤sğŸ›‘â€â€â€â„-4
      - include           : anyğŸ›‘
  char-esc-uniâ„-:
    - match               : '(u)({)({{d_hex}}{1,6})(})'
      captures            :
        1:                 constant.character.escape.utf8.hex.kdl comment.line.slash-dash.kdl
        2:                 constant.character.escape.utf8.hex.kdl punctuation.definition.usv.begin.kdl comment.line.slash-dash.kdl
        3:                 constant.character.escape.utf8.hex.kdl comment.line.slash-dash.kdl
        4:                 constant.character.escape.utf8.hex.kdl punctuation.definition.usv.end.kdl comment.line.slash-dash.kdl
      pop                 : 1
  char-esc-uniâ„-ğŸ›‘:
      - match             : '(u)({)({{codepoint_not_hex}})(})'
        captures          :
          1:               constant.character.escape.utf8.hex.kdl comment.line.slash-dash.kdl
          2:               constant.character.escape.utf8.hex.kdl punctuation.definition.usv.begin.kdl comment.line.slash-dash.kdl
          3:               constant.character.escape.utf8.hex.kdl invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
          4:               constant.character.escape.utf8.hex.kdl punctuation.definition.usv.end.kdl comment.line.slash-dash.kdl
        pop               : 1
      - match             : '(u)({)({{usv_not_hex}})(})'
        captures          :
          1:               constant.character.escape.utf8.hex.kdl comment.line.slash-dash.kdl
          2:               constant.character.escape.utf8.hex.kdl punctuation.definition.usv.begin.kdl comment.line.slash-dash.kdl
          3:               constant.character.escape.utf8.hex.kdl invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
          4:               constant.character.escape.utf8.hex.kdl punctuation.definition.usv.end.kdl comment.line.slash-dash.kdl
        pop               : 1

  string-quoted-double-rawâ„-:
    - match               : '(r?)(#*)(")'
      captures            :
        1:                 invalid.illegal.position.kdl comment.line.slash-dash.kdl
        2:                 punctuation.definition.string.begin.kdl comment.line.slash-dash.kdl
        3:                 punctuation.definition.string.begin.kdl comment.line.slash-dash.kdl
      push                :
      - meta_scope        : meta.string.kdl string.quoted.double.raw.kdl
      - meta_content_scope: comment.line.slash-dash.kdl
      - match             : '"\2' # â†‘match (#*)
        scope             : punctuation.definition.string.end.kdl comment.line.slash-dash.kdl
        pop               : 3
      - include           : â¤ğŸ›‘Â¹s
  string-quoted-double3-rawâ„-:
    - match               : '(r?)(#*)(""")({{nl_not_s}}?)' #({{nl_not_s}}*)
      captures            :
        1:                 invalid.illegal.position.kdl comment.line.slash-dash.kdl
        2:                 punctuation.definition.string.begin.kdl comment.line.slash-dash.kdl
        3:                 punctuation.definition.string.begin.kdl comment.line.slash-dash.kdl
        4:                 invalid.illegal.position.kdl comment.line.slash-dash.kdl
        # 5:                 invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
      push                :
      - meta_scope        : meta.string.kdl string.quoted.double.block.raw.kdl
      - meta_content_scope: comment.line.slash-dash.kdl
      - match             : '^({{u_sp}}*)({{u_sp_not}}?)([\s\S]*?)(""")(\2)' # â†‘match (#*)
      # - match             : '^(\s*)([^\"]?)([^\"]*)(""")'
        captures          :
          1:               whitespace.dedent.kdl comment.line.slash-dash.kdl
          2:               invalid.illegal.position.kdl comment.line.slash-dash.kdl
          3:               invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
          4:               punctuation.definition.string.end.kdl comment.line.slash-dash.kdl
          5:               punctuation.definition.string.end.kdl comment.line.slash-dash.kdl
        pop               : 3
      - match             : '([\S\s]?)([\S]*)(""")(\2)' # error pop
        captures          :
          1:               invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
          2:               invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
          3:               punctuation.definition.string.end.kdl comment.line.slash-dash.kdl
          4:               punctuation.definition.string.end.kdl comment.line.slash-dash.kdl
        pop               : 3
  strings-quoted-double-rawâ„-:
    - match               : '(r?)(#*)(")'
      captures            :
        1:                 invalid.illegal.position.kdl comment.line.slash-dash.kdl
        2:                 punctuation.definition.string.begin.kdl comment.line.slash-dash.kdl
        3:                 punctuation.definition.string.begin.kdl comment.line.slash-dash.kdl
      push                :
      - meta_scope        : meta.string.kdl string.quoted.double.raw.kdl
      - meta_content_scope: comment.line.slash-dash.kdl
      - match             : '"\2' # â†‘match (#*)
        scope             : punctuation.definition.string.end.kdl comment.line.slash-dash.kdl
        pop               : 1
      - include           : â¤ğŸ›‘Â¹s
  strings-quoted-double3-rawâ„-:
    - match               : '(r?)(#*)(""")({{nl_not_s}}?)' #({{nl_not_s}}*)
      captures            :
        1:                 invalid.illegal.position.kdl comment.line.slash-dash.kdl
        2:                 punctuation.definition.string.begin.kdl comment.line.slash-dash.kdl
        3:                 punctuation.definition.string.begin.kdl comment.line.slash-dash.kdl
        4:                 invalid.illegal.position.kdl comment.line.slash-dash.kdl
        # 5:                 invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
      push                :
      - meta_scope        : meta.string.kdl string.quoted.double.block.raw.kdl
      - meta_content_scope: comment.line.slash-dash.kdl
      - match             : '^({{u_sp}}*)({{u_sp_not}}?)([\s\S]*?)(""")(\2)' # â†‘match (#*)
      # - match             : '^(\s*)([^\"]?)([^\"]*)(""")'
        captures          :
          1:               whitespace.dedent.kdl comment.line.slash-dash.kdl
          2:               invalid.illegal.position.kdl comment.line.slash-dash.kdl
          3:               invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
          4:               punctuation.definition.string.end.kdl comment.line.slash-dash.kdl
          5:               punctuation.definition.string.end.kdl comment.line.slash-dash.kdl
        pop               : 1
      - match             : '([\S\s]?)([\S]*)(""")(\2)' # error pop
        captures          :
          1:               invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
          2:               invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
          3:               punctuation.definition.string.end.kdl comment.line.slash-dash.kdl
          4:               punctuation.definition.string.end.kdl comment.line.slash-dash.kdl
        pop               : 1
  strings-quoted-double-rawâ„-_node-id:
    - match               : '(r?)(#*)(")'
      captures            :
        1:                 invalid.illegal.position.kdl comment.line.slash-dash.kdl
        2:                 punctuation.definition.string.begin.kdl comment.line.slash-dash.kdl
        3:                 punctuation.definition.string.begin.kdl comment.line.slash-dash.kdl
      push                :
      - meta_scope        : entity.name.tag.node.kdl meta.string.kdl string.quoted.double.raw.kdl
      - meta_content_scope: comment.line.slash-dash.kdl
      - match             : '"\2' # â†‘match (#*)
        scope             : punctuation.definition.string.end.kdl comment.line.slash-dash.kdl
        pop               : 1
      - include           : â¤ğŸ›‘Â¹s
  strings-quoted-double3-rawâ„-_node-id:
    - match               : '(r?)(#*)(""")({{nl_not_s}}?)' #({{nl_not_s}}*)
      captures            :
        1:                 invalid.illegal.position.kdl comment.line.slash-dash.kdl
        2:                 punctuation.definition.string.begin.kdl comment.line.slash-dash.kdl
        3:                 punctuation.definition.string.begin.kdl comment.line.slash-dash.kdl
        4:                 invalid.illegal.position.kdl comment.line.slash-dash.kdl
        5:                 invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
      push                :
      - meta_scope        : entity.name.tag.node.kdl meta.string.kdl string.quoted.double.block.raw.kdl
      - meta_content_scope: comment.line.slash-dash.kdl
      - match             : '^({{u_sp}}*)({{u_sp_not}}?)([\s\S]*?)(""")(\2)' # â†‘match (#*)
      # - match             : '^(\s*)([^\"]?)([^\"]*)(""")'
        captures          :
          1:               whitespace.dedent.kdl comment.line.slash-dash.kdl
          2:               invalid.illegal.position.kdl comment.line.slash-dash.kdl
          3:               invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
          4:               punctuation.definition.string.end.kdl comment.line.slash-dash.kdl
          5:               punctuation.definition.string.end.kdl comment.line.slash-dash.kdl
        pop               : 1
      - match             : '([\S\s]?)([\S]*)(""")(\2)' # error pop
        captures          :
          1:               invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
          2:               invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
          3:               punctuation.definition.string.end.kdl comment.line.slash-dash.kdl
          4:               punctuation.definition.string.end.kdl comment.line.slash-dash.kdl
        pop               : 1


#â€”â€”â€” Values - Numbers
  # intâˆ¨decâˆ¨floatâ„-:
  #   - match               : '([+-])?([0-9])' # leading zeros are allowed
  #     captures            :
  #       1:                  keyword.operator.arithmetic.kdl comment.line.slash-dash.kdl
  #       2:                  comment.line.slash-dash.kdl
  #     branch_point        : â¸™intâˆ¨decâˆ¨floatâ„-
  #     branch              :
  #       - integerâ„-â¸™
  #       - decimalâ„-â¸™
  #       - floatâ„-â¸™
  # failâ¸™intâˆ¨decâˆ¨floatâ„-.:
  #   - match               : '\.'
  #     fail                : â¸™intâˆ¨decâˆ¨floatâ„-
  # failâ¸™intâˆ¨decâˆ¨floatâ„-â„¯:
  #   - match               : '[eE]'
  #     fail                : â¸™intâˆ¨decâˆ¨floatâ„-
  # integerâ„-â¸™:
  #   - meta_scope          : constant.numeric.value.kdl constant.numeric.integer.kdl
  #   - include             : failâ¸™intâˆ¨decâˆ¨floatâ„-.
  #   - include             : failâ¸™intâˆ¨decâˆ¨floatâ„-â„¯
  #   - include             : digitâ‚â‚€_â„-
  #   - include             : pop3â¸™
  decimalâ„-â¸™:
    - meta_scope          : constant.numeric.value.kdl constant.numeric.decimal.kdl
    - include             : failâ¸™intâˆ¨decâˆ¨floatâ„-â„¯
    - include             : digitâ‚â‚€_â„-
    - match               : '(\.)(?={{newline}})'
      # scope               : punctuation.separator.decimal.kdl comment.line.slash-dash.kdl
      pop                 : 1
      push                :
      - include           : pop3
    - match               : '(\.)(?={{u_sp}}|;)'
      scope               : invalid.illegal.muted.position.kdl
      pop                 : 1
      push                :
      - include           : pop3
    - match               : '(\.)'
      scope               : punctuation.separator.decimal.kdl comment.line.slash-dash.kdl
      push                :
      - include           : failâ¸™intâˆ¨decâˆ¨floatâ„-â„¯
      - include           : â„¤â„-s
      - include           : pop4
    - include             : pop3â¸™
  # floatâ„-â¸™:
  #   - meta_scope          : constant.numeric.value.kdl constant.numeric.float.kdl constant.numeric.significand.kdl
  #   - include             : digitâ‚â‚€_â„-
  #   - include             : floatï¼â„-
  #   - include             : floatâ„¯â„-partial
  #   - include             : floatâ„¯â„-
  #   - include             : pop3â¸™
  floatï¼â„-:
    - match               : '(\.)(?={{newline}})'
      # scope               : punctuation.separator.decimal.kdl comment.line.slash-dash.kdl
      pop                 : 1
      push                :
      - include           : pop
    - match               : '(\.)(?={{u_sp}}|;)'
      scope               : invalid.illegal.muted.position.kdl
      pop                 : 1
      push                :
      - include           : pop
    - match               : '(\.)(?=[^0-9])'
      scope               : invalid.illegal.muted.position.kdl
    - match               : '(\.)'
      scope               : punctuation.separator.decimal.kdl comment.line.slash-dash.kdl
      push                :
      - include           : digitâ‚â‚€_â„-
      - include           : pop
  # floatâ„¯â„-partial:
  #   - match               : '([eE])([+-])?(?={{nl_s}})'
  #     captures            :
  #       1:                  punctuation.separator.exponent.kdl comment.line.slash-dash.kdl
  #       2:                  keyword.operator.arithmetic.kdl comment.line.slash-dash.kdl
  #     push                :
  #     - clear_scopes      : 1 # clear previous meta scope significand
  #     - meta_scope        : constant.numeric.exponent.kdl
  #     - include           : pop4
  # floatâ„¯â„-:
  #   - match               : '([eE])([+-])?([0-9])'
  #     captures            :
  #       1:                  punctuation.separator.exponent.kdl comment.line.slash-dash.kdl
  #       2:                  keyword.operator.arithmetic.kdl comment.line.slash-dash.kdl
  #     push                :
  #     - clear_scopes      : 1 # clear previous meta scope significand
  #     - meta_scope        : constant.numeric.exponent.kdl
  #     - include           : digitâ‚â‚€_â„-
  #     - include           : pop4

  # binaryâ„-:
  #   - match               : '(0b)(?=[0-1])'
  #     scope               : constant.numeric.base.kdl comment.line.slash-dash.kdl
  #     push                :
  #     - meta_scope        : constant.numeric.integer.binary.kdl
  #     - meta_content_scope: constant.numeric.value.kdl
  #     - include           : â„¤â‚‚â„-
  # octalâ„-:
  #   - match               : '(0o)(?=[0-7])'
  #     scope               : constant.numeric.base.kdl comment.line.slash-dash.kdl
  #     push                :
  #     - meta_scope        : constant.numeric.integer.octal.kdl
  #     - meta_content_scope: constant.numeric.value.kdl
  #     - include           : â„¤â‚ˆâ„-
  # hexadecimalâ„-:
  #   - match               : '(0x)(?=\h)'
  #     scope               : constant.numeric.base.kdl comment.line.slash-dash.kdl
  #     push                :
  #     - meta_scope        : constant.numeric.integer.hexadecimal.kdl
  #     - meta_content_scope: constant.numeric.value.kdl
  #     - include           : â„¤â‚â‚†â„-

  # binÂ¦octÂ¦hexâ„-partial:
  #   - include             : binaryâ„-partial
  #   - include             : octalâ„-partial
  #   - include             : hexadecimalâ„-partial
  # binaryâ„-partial:
  #   - match               : '(0b)(?={{nl_s}})'
  #     scope               : constant.numeric.base.kdl comment.line.slash-dash.kdl
  #     push                :
  #     - meta_scope        : constant.numeric.integer.binary.kdl
  #     - include           : pop5
  # octalâ„-partial:
  #   - match               : '(0o)(?={{nl_s}})'
  #     scope               : constant.numeric.base.kdl comment.line.slash-dash.kdl
  #     push                :
  #     - meta_scope        : constant.numeric.integer.octal.kdl
  #     - include           : pop5
  hexadecimalâ„-partial:
    - match               : '(0)(x)(?={{nl_s}})'
      captures            :
        1:                  constant.numeric.integer.hexadecimal.kdl constant.numeric.base.kdl comment.line.slash-dash.kdl
        # 2:                  constant.numeric.integer.hexadecimal.kdl constant.numeric.base.kdl comment.line.slash-dash.kdl
      push                :
      - include           : pop5

  # Values - Numbers (helpers) digitâ‚â‚€_
  # can't match repeatable group in a regex, so repeat a single digit match
  # â„¤â„-:
  #   - match               : '([0-9])'
  #     scope               : comment.line.slash-dash.kdl
  #     push                :
  #     - include           : digitâ‚â‚€_â„-
  #     - include           : pop4
  â„¤â„-s:
    - match               : '([0-9])'
      scope               : comment.line.slash-dash.kdl
      push                :
      - include           : digitâ‚â‚€_â„-
      - include           : pop
  # â„¤â‚‚â„-:
  #   - match               : '([0-1])'
  #     scope               : comment.line.slash-dash.kdl
  #     push                :
  #     - include           : digitâ‚‚_â„-
  #     - include           : pop4
  # â„¤â‚ˆâ„-:
  #   - match               : '([0-7])'
  #     scope               : comment.line.slash-dash.kdl
  #     push                :
  #     - include           : digitâ‚ˆ_â„-
  #     - include           : pop4
  # â„¤â‚â‚†â„-:
  #   - match               : '(\h)'
  #     scope               : comment.line.slash-dash.kdl
  #     push                :
  #     - include           : digitâ‚â‚†_â„-
  #     - include           : pop4
  # digitâ‚â‚€_â„-:
  #   - match               : '(_)|([0-9])'
  #     captures            :
  #       1:                  punctuation.separator.number.kdl comment.line.slash-dash.kdl
  #       2:                  comment.line.slash-dash.kdl
  # digitâ‚‚_â„-:
  #   - match               : '(_)|([0-1])'
  #     captures            :
  #       1:                  punctuation.separator.number.kdl comment.line.slash-dash.kdl
  #       2:                  comment.line.slash-dash.kdl
  # digitâ‚ˆ_â„-:
  #   - match               : '(_)|([0-7])'
  #     captures            :
  #       1:                  punctuation.separator.number.kdl comment.line.slash-dash.kdl
  #       2:                  comment.line.slash-dash.kdl
  # digitâ‚â‚†_â„-:
  #   - match               : '(_)|([0-9a-fA-F])'
  #     captures            :
  #       1:                  punctuation.separator.number.kdl comment.line.slash-dash.kdl
  #       2:                  comment.line.slash-dash.kdl


#â€”â€”â€” 2 Node Element: 4 Child
  node_children_sâ„-â¸™3:    #âœ—â´â¸™  Sequence of /-{children} blocks, fails if argâˆ¨prop detected; Handle /- directly since /-{ch} must be after argâˆ¨prop (so we can't include both at the same level and we can't pop an extra level up). Also /-{ch} can be repeated while {ch} can't
    - meta_scope          : meta.argument.value.kdl meta.mapping.value.kdl #âœ—â´node_children_sâ„-â¸™3
    - match               : '({{c_slashdash}})' # repeatable /-{ch}, pop up to âœ—â´
      scope               : comment.line.slash-dash.kdl punctuation.definition.comment.begin.kdl
      # pop                 : 1
      # set                 :
      push                : #âœ—5
      - include           : linesp
      - include           : child_block_on_follow_pop2â„-
      - match             : '\S'
        fail              : â¸™3node_châˆ¨argpropâ„-
      # - include           : SğŸ›‘s
      # - include           : popâ¸™ #âœ—4=@start, ğŸ—˜
    - include             : child_block3
    # - match               : ''
      # fail                : â¸™3node_châˆ¨argpropâ„-
    - include             : popâ¸™

  node_childrenâ„-s:        #âœ—â´ sequence of /-{ch} blocks after {ch}, so nothing else allowed
    - meta_scope          : meta.argument.value.kdl meta.mapping.value.kdl #âœ—â´node_childrenâ„-s
    - match               : '({{c_slashdash}})' # repeatable /-{ch}, pop up to âœ—â´
      scope               : comment.line.slash-dash.kdl punctuation.definition.comment.begin.kdl
      push                : #âœ—5
      - include           : linesp
      - include           : child_blockâ„- #âœ—4=@start, ğŸ—˜
      - include           : SğŸ›‘s
    - match               : '([^}])([^}]*)' # error on } err {
      captures            :
        1:                  invalid.illegal.position.kdl
        2:                  invalid.illegal.muted.position.kdl

  # child_blockâ„-:
  #   - match               : '{'
  #     scope               : punctuation.section.mapping.begin.kdl comment.line.slash-dash.kdl
  #     push                : child_block-bodyâ„-
  child_block3â„-:
    - match               : '{'
      scope               : punctuation.section.mapping.begin.kdl comment.line.slash-dash.kdl
      push                : child_block3-bodyâ„-
  child_block4â„-:
    - match               : '{'
      scope               : punctuation.section.mapping.begin.kdl comment.line.slash-dash.kdl
      push                : child_block4-bodyâ„-
  child_block1â„-:
    - match               : '{'
      scope               : punctuation.section.mapping.begin.kdl comment.line.slash-dash.kdl
      push                : child_block1-bodyâ„-
  child_block_on_follow_pop2â„-: #âœ—âµ
    - match               : '{'
      scope               : punctuation.section.mapping.begin.kdl comment.line.slash-dash.kdl
      push                : child_block_on_follow_pop2-bodyâ„- #âœ—â¶
  child_block6â„-:
    - match               : '{'
      scope               : punctuation.section.mapping.begin.kdl comment.line.slash-dash.kdl
      push                : child_block6-bodyâ„-
  child_block-bodyâ„-:
    - meta_scope          : meta.block.child.kdl
    - include             : wss
    - include             : comment_line_noâ¤
    - include             : ï½ch2t3â„-
    - match               : '(?=\S)'
      push                : nodesâ„-
  child_block3-bodyâ„-:
    - meta_scope          : meta.block.child.kdl
    - include             : wss
    - include             : comment_line_noâ¤
    - include             : ï½ch1t3â„-
    - match               : '(?=\S)'
      push                : nodesâ„-
  child_block4-bodyâ„-:
    - meta_scope          : meta.block.child.kdl
    - include             : wss
    - include             : comment_line_noâ¤
    - include             : ï½ch1t4â„-
    - match               : '(?=\S)'
      push                : nodesâ„-
  child_block1-bodyâ„-:
    - meta_scope          : meta.block.child.kdl
    - include             : wss
    - include             : comment_line_noâ¤
    - include             : ï½ch0t2â„-
    - match               : '(?=\S)'
      push                : nodesâ„-
    # - include             : pop2
  child_block_on_follow_pop2-bodyâ„-: #âœ—â¶
    - meta_scope          : meta.block.child.kdl
    - include             : wss
    - include             : comment_line_noâ¤
    - include             : ï½ch1t5nofolpop1â¸®â„-
    - match               : '(?=\S)'
      push                : nodesâ„-
    # - include             : pop2
  child_block6-bodyâ„-:
    - meta_scope          : meta.block.child.kdl
    - include             : wss
    - include             : comment_line_noâ¤
    - include             : ï½2t4â„-
    - match               : '(?=\S)'
      push                : nodesâ„-


#â€”â€”â€” 2 Node Element: 5 End
  # node_terminatorâ„-:
  #   - include             : comment_lineâ„-
  #   - include             : â¤
  #   - include             : eof
  #   # - include             : popï½
  #   - match               : ;
  #     scope               : punctuation.terminator.node.kdl comment.line.slash-dash.kdl
  #     pop                 : 1
  #   - include             : ï½ğŸ›‘
  # node_terminator2â„-:
  #   - include             : comment_line2_termâ„-
  #   - include             : â¤term2
  #   - include             : eof2
  #   - match               : ;
  #     scope               : punctuation.terminator.node.kdl comment.line.slash-dash.kdl
  #     pop                 : 2
  #   - include             : ï½ğŸ›‘2
  node_end5â„-:
    - include             : comment_line5_termâ„-
    - include             : â¤term5â„-
    - include             : eof5
    - match               : ;
      scope               : punctuation.terminator.node.kdl comment.line.slash-dash.kdl #âœ—node_end5â„-
      pop                 : 5
  node_end4â„-:
    - include             : comment_line4_termâ„-
    - include             : â¤term4â„-
    - include             : eof4
    - match               : ;
      scope               : punctuation.terminator.node.kdl comment.line.slash-dash.kdl #âœ—node_end4â„-
      pop                 : 4
  node_end3â„-:
    - include             : comment_line3_termâ„-
    - include             : â¤term3â„-
    - include             : eof3
    - match               : ;
      scope               : punctuation.terminator.node.kdl comment.line.slash-dash.kdl #âœ—node_end3â„-
      pop                 : 3
  node_end2â„-:
    - include             : comment_line2_termâ„-
    - include             : â¤term2â„-
    - include             : eof2
    - match               : ;
      scope               : punctuation.terminator.node.kdl comment.line.slash-dash.kdl #âœ—node_end2â„-
      pop                 : 2
  node_endâ„-:
    - include             : comment_line_termâ„-
    - include             : â¤termâ„-
    - include             : eof
    - match               : ;
      scope               : punctuation.terminator.node.kdl comment.line.slash-dash.kdl
      pop                 : 1
  node_terminator3â„-:
    - include             : node_end3â„-
    - include             : ï½ğŸ›‘3
  nodech_terminator5â¸®â„-:
    - include             : node_end5â„-
    - include             : ï½5
    - include             : ï½ğŸ›‘5
  nodech_terminator4â¸®â„-:
    - include             : node_end4â„-
    - include             : ï½4
    - include             : ï½ğŸ›‘4
  nodech_terminator3â¸®â„-:
    - include             : node_end3â„-
    - include             : ï½3
    - include             : ï½ğŸ›‘3
  nodech_terminator2â¸®â„-:
    - include             : node_end2â„-
    - include             : ï½2
    - include             : ï½ğŸ›‘2
  nodech_terminatorâ¸®â„-:
    - include             : node_endâ„-
    - include             : ï½
    - include             : ï½ğŸ›‘
  # node_terminator4â„-:
  #   - include             : comment_line4_termâ„-
  #   - include             : â¤term4
  #   - include             : eof4
  #   - match               : ;
  #     scope               : punctuation.terminator.node.kdl comment.line.slash-dash.kdl
  #     pop                 : 4
  #   - include             : ï½ğŸ›‘4

  ï½1t3â„-:
    - match               : '}'
      scope               : punctuation.section.mapping.end.kdl comment.line.slash-dash.kdl
      pop                 : 2
      push                :
      - include           : wss
      - include           : node_terminator3â„-
      - include           : SğŸ›‘Â¹preâ¤
  ï½0t2â„-:
    - match               : '}'
      scope               : punctuation.section.mapping.end.kdl comment.line.slash-dash.kdl
      pop                 : 1 # reset meta child scope
      push                :
      - include           : wss
      - include           : node_terminator2â„-
      - include           : SğŸ›‘Â¹preâ¤
  ï½ch1t5nofolpop1â¸®â„-: #âœ—â¶
    - match               : '}'
      scope               : meta.block.child.kdl punctuation.section.mapping.end.kdl comment.line.slash-dash.kdl
      pop                 : 1 # replacing this with term4 doesn't reset meta.block.child.kdl after }, so reset it here
      push                : #âœ—â¶
      - include           : wss
      - include           : nodech_terminator5â¸®â„-
      - match             : '(?=/-|{)'
        pop               : 2
      - include           : SğŸ›‘Â¹pre_ws
  ï½ch0t2â„-: # allows /-{ch} blocks to continue after the ending
    - match               : '}'
      scope               : meta.block.child.kdl punctuation.section.mapping.end.kdl comment.line.slash-dash.kdl
      pop                 : 1
      push                :
      - include           : wss
      - include           : node_end2â„-
      - include           : node_childrenâ„-s
      - include           : pop2
  ï½ch1t3â„-:
    - match               : '}'
      scope               : meta.block.child.kdl punctuation.section.mapping.end.kdl comment.line.slash-dash.kdl
      pop                 : 2
      push                :
      - include           : wss
      - include           : node_end3â„-
      - include           : node_childrenâ„-s
      - include           : pop3
  ï½ch1t4â„-:
    - match               : '}'
      scope               : meta.block.child.kdl punctuation.section.mapping.end.kdl comment.line.slash-dash.kdl
      pop                 : 3
      push                :
      - include           : wss
      - include           : node_end4â„-
      - include           : node_childrenâ„-s
      - include           : pop4
  ï½2t3â„-:
    - match               : '}'
      scope               : punctuation.section.mapping.end.kdl comment.line.slash-dash.kdl
      pop                 : 3
      push                :
      - include           : wss
      - include           : node_terminator3â„-
      - include           : SğŸ›‘Â¹preâ¤
  ï½ch2t3â„-:
    - match               : '}'
      scope               : meta.block.child.kdl punctuation.section.mapping.end.kdl comment.line.slash-dash.kdl
      pop                 : 3
      push                :
      - include           : wss
      - include           : node_end3
      - include           : node_childrenâ„-s
      - include           : pop3
  ï½2t4â„-:
    - match               : '}'
      scope               : punctuation.section.mapping.end.kdl comment.line.slash-dash.kdl
      pop                 : 3
      push                :
      - include           : wss
      - include           : node_terminator4â„-
      - include           : SğŸ›‘Â¹preâ¤

  # line_continuationâ„-:
  #   - match               : \\
  #     scope               : punctuation.separator.continuation.line.kdl comment.line.slash-dash.kdl #âœ—lcâ„â€“
  #     push                : line_continuationâ„-line1
  # line_continuationâ„-line1:
  #   - include             : wss                         # â‰ ... ws*
  #   - include             : comment_line_noâ¤           # â‰ ... single-line-comment (without newline, so â†“ captures)
  #   - match               : '({{nl_s}})'                # â‰ ... newline
  #     set                 : line_continuationâ„-line_next
  #   - include             : SğŸ›‘s
  line_continuationâ„-line_next:
    - include             : wss
    - include             : comment_line_noâ¤
    - include             : â¤ğŸ›‘
    # - match               : \\                          # disallows repeated
    #   scope               : punctuation.separator.continuation.line.kdl invalid.illegal.position.kdl comment.line.slash-dash.kdl
    - include             : else-pop


#â€”â€”â€” Comments
  # comment_lineâ„-:
  #   - match               : //
  #     scope               : punctuation.definition.comment.begin.kdl comment.line.slash-dash.kdl
  #     push                :
  #       - meta_scope      : comment.line.double-slash.kdl comment.line.slash-dash.kdl
  #       - match           : $({{newline}})?
  #         pop             : 2
  #         captures        :
  #           1:              punctuation.definition.comment.end.kdl comment.line.slash-dash.kdl
  comment_line_termâ„-:
    - match               : //
      scope               : punctuation.definition.comment.begin.kdl punctuation.terminator.node.kdl comment.line.slash-dash.kdl
      push                :
        - meta_scope      : comment.line.double-slash.kdl comment.line.slash-dash.kdl
        - match           : $({{newline}})?
          pop             : 2
          captures        :
            1:              punctuation.definition.comment.end.kdl comment.line.slash-dash.kdl
  comment_line2_termâ„-:
    - match               : //
      scope               : punctuation.definition.comment.begin.kdl punctuation.terminator.node.kdl comment.line.slash-dash.kdl
      push                :
        - meta_scope      : comment.line.double-slash.kdl comment.line.slash-dash.kdl
        - match           : $({{newline}})?
          pop             : 3
          captures        :
            1:              punctuation.definition.comment.end.kdl comment.line.slash-dash.kdl
  # comment_line3_termâ„-:
  #   - match               : //
  #     scope               : punctuation.definition.comment.begin.kdl punctuation.terminator.node.kdl comment.line.slash-dash.kdl
  #     push                :
  #       - meta_scope      : comment.line.double-slash.kdl comment.line.slash-dash.kdl
  #       - match           : $({{newline}})?
  #         pop             : 4
  #         captures        :
  #           1:              punctuation.definition.comment.end.kdl punctuation.terminator.node.kdl comment.line.slash-dash.kdl
  # comment_line4_termâ„-:
  #   - match               : //
  #     scope               : punctuation.definition.comment.begin.kdl comment.line.slash-dash.kdl
  #     push                :
  #       - meta_scope      : comment.line.double-slash.kdl comment.line.slash-dash.kdl
  #       - match           : $({{newline}})?
  #         pop             : 5
  #         captures        :
  #           1:              punctuation.definition.comment.end.kdl comment.line.slash-dash.kdl
  comment_line5_termâ„-:
    - match               : //
      scope               : punctuation.definition.comment.begin.kdl comment.line.slash-dash.kdl
      push                :
        - meta_scope      : comment.line.double-slash.kdl comment.line.slash-dash.kdl
        - match           : $({{newline}})?
          pop             : 6
          captures        :
            1:              punctuation.definition.comment.end.kdl comment.line.slash-dash.kdl
  â„-ğŸ›‘:
    - match               : '({{c_slashdash}})'
      scope               : comment.line.slash-dash.kdl punctuation.definition.comment.begin.kdl invalid.illegal.position.kdl


# Primitives, with some ~matching KDL Spec elements
  â¤termâ„-:
    - match               : '{{newline}}'
      scope               : punctuation.terminator.node.kdl comment.line.slash-dash.kdl #âœ—â¤1
      pop                 : 1
  â¤term2â„-:
    - match               : '{{newline}}'
      scope               : punctuation.terminator.node.kdl comment.line.slash-dash.kdl #âœ—â¤2
      pop                 : 2
  â¤term3â„-:
    - match               : '{{newline}}'
      scope               : punctuation.terminator.node.kdl comment.line.slash-dash.kdl #âœ—â¤3
      pop                 : 3
  â¤term4â„-:
    - match               : '{{newline}}'
      scope               : punctuation.terminator.node.kdl comment.line.slash-dash.kdl #âœ—â¤4
      pop                 : 4
  â¤term5â„-:
    - match               : '{{newline}}'
      scope               : punctuation.terminator.node.kdl comment.line.slash-dash.kdl #âœ—â¤5
      pop                 : 5


# Various helpers
  charğŸ†”Â¬â„-:
    - match               : '{{charID_not}}'
      scope               : invalid.illegal.kdl comment.line.slash-dash.kdl #âœ—chID
  ID_bareÂ¬1stğŸ›‘â„-:
    # - match               : '({{charID_not1st}})'
    - match               : '(?<!=){{charID_not1st}}' # K=V lookbehind prevents matching V after K fails
      captures            :
        1:                  invalid.illegal.position.kdl comment.line.slash-dash.kdl
        2:                  invalid.illegal.position.kdl comment.line.slash-dash.kdl
        3:                  invalid.illegal.muted.position.kdl comment.line.slash-dash.kdl
      # pop                 : 1 # alternative without lookbehind, but this resets = to node, so worse?

  uâ â¤sğŸ›‘â€â€â€â„-2:   # errors on closing multi-line """
    - match               : '({{uspnl}})'
      scope               : whitespace.escape.kdl comment.line.slash-dash.kdl
      push                : # to "glue" contiguous spaces together with the same scope
      - match             : '({{uspnl}})'
        scope             : whitespace.escape.kdl comment.line.slash-dash.kdl
      - match             : '(")("")'
        captures          :
          1:               invalid.illegal.position.kdl punctuation.definition.string.end.kdl comment.line.slash-dash.kdl
          2:               invalid.illegal.muted.position.kdl punctuation.definition.string.end.kdl comment.line.slash-dash.kdl
        pop               : 3
      - include           : else-pop2
  uâ â¤sğŸ›‘â€â€â€â„-4:
    - match               : '({{uspnl}})'
      scope               : whitespace.escape.kdl comment.line.slash-dash.kdl
      push                : # to "glue" contiguous spaces together with the same scope
      - match             : '({{uspnl}})'
        scope             : whitespace.escape.kdl comment.line.slash-dash.kdl
      - match             : '(")("")'
        captures          :
          1:               invalid.illegal.position.kdl punctuation.definition.string.end.kdl comment.line.slash-dash.kdl
          2:               invalid.illegal.muted.position.kdl punctuation.definition.string.end.kdl comment.line.slash-dash.kdl
        pop               : 5
      - include           : else-pop2
